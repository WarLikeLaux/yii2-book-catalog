meta:
  title: 'Database Schema'
tables:
  async_idempotency_log:
    columns:
      -
        name: id
        type: int
        nullable: false
      -
        name: idempotency_key
        type: varchar(128)
        nullable: false
      -
        name: created_at
        type: int
        nullable: false
    primary_key:
      - id
    foreign_keys: []
    indexes:
      -
        name: idx_async_idempotency_log_created_at
        columns:
          - created_at
        unique: false
      -
        name: idx_async_idempotency_log_key
        columns:
          - idempotency_key
        unique: true
  authors:
    columns:
      -
        name: id
        type: int
        nullable: false
      -
        name: fio
        type: varchar(255)
        nullable: false
    primary_key:
      - id
    foreign_keys: []
    indexes:
      -
        name: idx_authors_fio_fulltext
        columns:
          - fio
        unique: false
      -
        name: idx_authors_fio_unique
        columns:
          - fio
        unique: true
  book_authors:
    columns:
      -
        name: book_id
        type: int
        nullable: false
      -
        name: author_id
        type: int
        nullable: false
    primary_key:
      - book_id
      - author_id
    foreign_keys:
      -
        column: author_id
        references: authors.id
      -
        column: book_id
        references: books.id
    indexes:
      -
        name: idx_book_authors_author_id
        columns:
          - author_id
        unique: false
  books:
    columns:
      -
        name: id
        type: int
        nullable: false
      -
        name: title
        type: varchar(255)
        nullable: false
      -
        name: year
        type: int
        nullable: false
      -
        name: description
        type: text
        nullable: true
      -
        name: isbn
        type: varchar(20)
        nullable: false
      -
        name: cover_url
        type: varchar(500)
        nullable: true
      -
        name: is_published
        type: tinyint(1)
        nullable: false
        default: 0
      -
        name: version
        type: int
        nullable: false
        default: 1
      -
        name: created_at
        type: int
        nullable: false
      -
        name: updated_at
        type: int
        nullable: false
      -
        name: status
        type: varchar(20)
        nullable: false
        default: draft
    primary_key:
      - id
    foreign_keys: []
    indexes:
      -
        name: idx_books_cover_url_partial
        columns:
          - cover_url
        unique: false
      -
        name: idx_books_isbn
        columns:
          - isbn
        unique: true
      -
        name: idx_books_status
        columns:
          - status
        unique: false
      -
        name: idx_books_title
        columns:
          - title
        unique: false
      -
        name: idx_books_title_desc_fulltext
        columns:
          - title
          - description
        unique: false
      -
        name: idx_books_year
        columns:
          - year
        unique: false
  idempotency_keys:
    columns:
      -
        name: id
        type: int
        nullable: false
      -
        name: idempotency_key
        type: varchar(128)
        nullable: false
      -
        name: status
        type: varchar(20)
        nullable: false
        default: finished
      -
        name: status_code
        type: int
        nullable: true
      -
        name: response_body
        type: blob
        nullable: true
      -
        name: created_at
        type: int
        nullable: false
      -
        name: expires_at
        type: int
        nullable: false
    primary_key:
      - id
    foreign_keys: []
    indexes:
      -
        name: idx_idempotency_keys_expires_at
        columns:
          - expires_at
        unique: false
      -
        name: idx_idempotency_keys_key
        columns:
          - idempotency_key
        unique: true
  migration:
    columns:
      -
        name: version
        type: varchar(180)
        nullable: false
      -
        name: apply_time
        type: int
        nullable: true
    primary_key:
      - version
    foreign_keys: []
    indexes: []
  queue:
    columns:
      -
        name: id
        type: int
        nullable: false
      -
        name: channel
        type: varchar(255)
        nullable: false
      -
        name: job
        type: blob
        nullable: false
      -
        name: pushed_at
        type: int
        nullable: false
      -
        name: ttr
        type: int
        nullable: false
      -
        name: delay
        type: int
        nullable: false
        default: 0
      -
        name: priority
        type: 'int unsigned'
        nullable: false
        default: 1024
      -
        name: reserved_at
        type: int
        nullable: true
      -
        name: attempt
        type: int
        nullable: true
      -
        name: done_at
        type: int
        nullable: true
    primary_key:
      - id
    foreign_keys: []
    indexes:
      -
        name: idx_queue_channel_reserved_at_priority
        columns:
          - channel
          - reserved_at
          - priority
        unique: false
      -
        name: idx_queue_reserved_at
        columns:
          - reserved_at
        unique: false
  subscriptions:
    columns:
      -
        name: id
        type: int
        nullable: false
      -
        name: phone
        type: varchar(20)
        nullable: false
      -
        name: author_id
        type: int
        nullable: false
      -
        name: created_at
        type: int
        nullable: false
    primary_key:
      - id
    foreign_keys:
      -
        column: author_id
        references: authors.id
    indexes:
      -
        name: fk_subscriptions_author
        columns:
          - author_id
        unique: false
      -
        name: idx_subscriptions_phone_author
        columns:
          - phone
          - author_id
        unique: true
