# ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

[â† ĞĞ°Ğ·Ğ°Ğ´ Ğ² README](../README.md)

Ğ’ Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ¼ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ. Ğ­Ñ‚Ğ¾ **Clean-ish** Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°: Ğ½Ğµ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Clean, Ğ½Ğ¾ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ Ğº Ğ¸Ğ´ĞµĞ°Ğ»Ñƒ Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğ¹ Yii2.


## ğŸ“Œ ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ
- [ğŸ¯ Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾](#-Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ-Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾-clean-architecture)
- [ğŸ—º Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ»Ğ¾ĞµĞ² (Mermaid)](#-Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ-ÑĞ»Ğ¾ĞµĞ²-mermaid)
- [ğŸ“Š Ğ¢Ñ€Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ¾Ğ´Ğ°](#-Ñ‚Ñ€Ğ¸-ÑƒÑ€Ğ¾Ğ²Ğ½Ñ-Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸-ĞºĞ¾Ğ´Ğ°)
- [ğŸ”„ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ½Ğ¸Ğ³Ğ¸ (Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ 1, 2, 3)](#-Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€-ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ-ĞºĞ½Ğ¸Ğ³Ğ¸)
- [ğŸ“ˆ Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°](#-ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ-Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°)
- [ğŸ§© Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² (Ğ‘Ñ‹Ğ»Ğ¾ â†’ Ğ¡Ñ‚Ğ°Ğ»Ğ¾)](#-ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹-Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½-Ğ±Ñ‹Ğ»Ğ¾--ÑÑ‚Ğ°Ğ»Ğ¾)
- [ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°](#-ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-ÑÑ‚Ğ¾Ğ³Ğ¾-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)

---

## ğŸ¯ Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ Clean Architecture

> **Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚, ĞºĞ°Ğº ĞµÑ‘ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ¸ ĞºÑƒĞ´Ğ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.**

```
Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ ÑĞ»Ğ¾Ğ¸ (Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ Yii2):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRESENTATION   â”‚ Controllers, Forms, Views               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  INFRASTRUCTURE â”‚ ActiveRecord, Queue, Repositories       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ â†“
Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ ÑĞ»Ğ¾Ğ¸ (Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¹ PHP, Ğ±ĞµĞ· Yii):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APPLICATION    â”‚ UseCases, Commands, Queries, Ports      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DOMAIN         â”‚ Entities, Value Objects, Events          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ— ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° C4 Model

ĞœÑ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ C4 Ğ´Ğ»Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ Ğ½Ğ° Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑƒÑ€Ğ¾Ğ²Ğ½ÑÑ… Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ğ¸.

#### Level 1: System Context
**Ğ¡Ñ…ĞµĞ¼Ğ° Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼ Ğ¼Ğ¸Ñ€Ğ¾Ğ¼.**

```mermaid
graph TD
    User((User/Admin))
    System[Book Catalog System]
    SMS["SMS Provider (External)"]
    Buggregator["Buggregator (Dev Tools)"]

    User -- "Browses & Manages Books" --> System
    System -- "Sends Notifications" --> SMS
    System -- "Sends Logs/Emails" --> Buggregator
    
    style System fill:#1168bd,stroke:#0b4884,color:#ffffff
    style SMS fill:#999999,stroke:#666666,color:#ffffff
    style Buggregator fill:#999999,stroke:#666666,color:#ffffff
```

#### Level 2: Containers
**Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹ (Docker).**

```mermaid
graph TD
    User((User))
    
    subgraph DockerHost ["Docker Host"]
        Nginx["Nginx (Web Server)"]
        PHP["PHP-FPM (Application)"]
        Worker["Queue Worker (PHP CLI)"]
        DB[("MySQL 8.0 (Database + Queue Table)")]
        Redis[("Redis (Cache)")]
    end
    
    SMS["SMS Provider"]

    User -- HTTPS --> Nginx
    Nginx -- FastCGI --> PHP
    
    PHP -- Read/Write --> DB
    PHP -- Push Jobs --> DB
    PHP -- Cache --> Redis
    
    Worker -- Pop Jobs --> DB
    Worker -- Read/Write --> DB
    Worker -- API Calls --> SMS
    
    style PHP fill:#1168bd,stroke:#0b4884,color:#ffffff
    style Worker fill:#1168bd,stroke:#0b4884,color:#ffffff
    style DB fill:#2f95c4,stroke:#206a8c,color:#ffffff
    style Redis fill:#2f95c4,stroke:#206a8c,color:#ffffff
```

ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ‡ĞµÑ€ĞµĞ· DB-Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€ (`yii\queue\db\Queue`): Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ Ğ»ĞµĞ¶Ğ°Ñ‚ Ğ² MySQL. Redis Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ°Ğº ĞºÑÑˆ.

#### Level 3: Components (Application Layer)
**Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ĞµĞµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ Application Layer (Clean Architecture).**

```mermaid
graph TD
    subgraph Presentation ["Presentation Layer (Yii2)"]
        Controller[Web Controller]
        Handler[Command Handler]
        Mapper[Mapper]
        Filter[Idempotency Filter]
    end

    subgraph Application ["Application Layer (Pure PHP)"]
        UseCase[Use Case]
        Port["Outbound Port (Interface)"]
    end

    subgraph Domain ["Domain Layer (Pure PHP)"]
        Entity[Domain Entity]
        VO[Value Object]
        Event[Domain Event]
    end

    subgraph Infrastructure ["Infrastructure Layer"]
        RepoImpl[Repository/QueryService Impl]
        Adapter[Adapter Impl]
        AR[ActiveRecord]
        Job[Queue Job]
    end

    DB[(Database)]

    %% Request Flow
    Controller -- "1. Form DTO" --> Handler
    Handler -- "2. Map to Command" --> Mapper
    Handler -- "3. Execute Command" --> UseCase
    Filter -- "Mutex Lock" --> Handler
    
    %% Logic Flow
    UseCase -- "4. Business Logic" --> Entity
    Entity -- "5. Rules" --> VO
    UseCase -- "6. Publish Event" --> Port
    UseCase -- "7. Save" --> Port
    
    %% Infra Implementation
    RepoImpl -.->|"Implements"| Port
    Adapter -.->|"Implements"| Port
    
    RepoImpl -- "8. Map to AR" --> AR
    AR -- "9. SQL" --> DB
    
    Adapter -- "Async" --> Job
    
    style UseCase fill:#1168bd,stroke:#0b4884,color:#ffffff
    style Entity fill:#1168bd,stroke:#0b4884,color:#ffffff
    style VO fill:#1168bd,stroke:#0b4884,color:#ffffff
```

### ğŸ¯ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

1. **Ğ˜Ğ½Ğ²ĞµÑ€ÑĞ¸Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ (DIP)**: ÑĞ»Ğ¾Ğ¹ Application Ğ½Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Infrastructure. Ğ’Ğ¼ĞµÑÑ‚Ğ¾ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¾Ğ½ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ (Ports), ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Infrastructure Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚. Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ»ĞµĞ³ĞºĞ¾ Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ MySQL Ğ½Ğ° PostgreSQL Ğ¸Ğ»Ğ¸ SMS-Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸.
2. **Ğ¢Ğ¾Ğ½ĞºĞ¸Ğµ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ñ‹ Ğ¸ AR**: Yii2 ActiveRecord Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ **Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾** Ğ² ÑĞ»Ğ¾Ğµ Infrastructure ĞºĞ°Ğº Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ. Ğ’ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ğ°Ñ… Ğ½ĞµÑ‚ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğº Ğ¼Ğ¾Ğ´ĞµĞ»ÑĞ¼ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ¸Ğ»Ğ¸ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ¸.
3. **ĞŸÑ€ĞµĞ´ÑĞºĞ°Ğ·ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ (Value Objects)**: Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹. Ğ•ÑĞ»Ğ¸ Ğ¾Ğ±ÑŠĞµĞºÑ‚ `Isbn` Ğ¸Ğ»Ğ¸ `BookYear` ÑĞ¾Ğ·Ğ´Ğ°Ğ½ â€” Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ½ĞµĞ¼ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹. Ğ­Ñ‚Ğ¾ Ğ¸Ğ·Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¾Ñ‚ Ñ‚Ñ‹ÑÑÑ‡ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº `if` Ğ² ĞºĞ¾Ğ´Ğµ.

### Ğ§Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚?

**UseCase (`CreateBookUseCase`) Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚:**
- Ğ­Ñ‚Ğ¾ HTTP-Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¸Ğ»Ğ¸ CLI-ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°?
- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· HTML-Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¸Ğ· REST API?
- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² MySQL, PostgreSQL Ğ¸Ğ»Ğ¸ MongoDB?
- SMS ÑˆĞ»Ñ‘Ğ¼ Ñ‡ĞµÑ€ĞµĞ· Twilio Ğ¸Ğ»Ğ¸ Ğ¿Ğ¸ÑˆĞµĞ¼ Ğ² Ñ„Ğ°Ğ¹Ğ»?

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Presentation Ğ¸ Infrastructure Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ Yii2 â€” ÑÑ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾:**
- Presentation = Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼. ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ñ‹, Ñ„Ğ¾Ñ€Ğ¼Ñ‹, Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚Ñ‹ â€” ÑÑ‚Ğ¾ Yii2.
- Infrastructure = Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ. ActiveRecord, Queue â€” ÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ¶Ğµ Yii2.
- Ğ­Ñ‚Ğ¾ **Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğµ ÑĞ»Ğ¾Ğ¸** â€” Ğ¾Ğ½Ğ¸ Ğ¿Ğ¾ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¹.

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Application Ğ¸ Domain Ñ‡Ğ¸ÑÑ‚Ñ‹Ğµ â€” ÑÑ‚Ğ¾ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾:**
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ Ğ² Symfony/Laravel Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹.
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±ĞµĞ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ HTTP.
- Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ½Ğµ Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€ĞºĞ°.

---

## ğŸ“Š Ğ¢Ñ€Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ¾Ğ´Ğ°

| Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ | ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´ | Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ |
|---------|--------|-----------------|
| **1** | Ğ¢Ğ¾Ğ»ÑÑ‚Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ | ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº, Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾Ñ‚Ğ¸Ğ¿ |
| **2** | ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ + Ğ¡ĞµÑ€Ğ²Ğ¸Ñ | Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğ¾ Yii2/Laravel Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ² |
| **3** | Clean Architecture | Enterprise, ÑĞ»Ğ¾Ğ¶Ğ½Ğ°Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° |

---

## ğŸ”„ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ½Ğ¸Ğ³Ğ¸

### Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1: Ğ¢Ğ¾Ğ»ÑÑ‚Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€

```php
// controllers/BookController.php
public function actionCreate()
{
    $model = new Book();
    
    if ($model->load(Yii::$app->request->post())) {
        // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ°
        $file = UploadedFile::getInstance($model, 'coverFile');
        if ($file) {
            $path = 'uploads/' . uniqid() . '.' . $file->extension;
            $file->saveAs(Yii::getAlias('@webroot/' . $path));
            $model->cover_url = '/' . $path;
        }
        
        // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ISBN (ĞºĞ¾Ğ¿Ğ¸Ğ¿Ğ°ÑÑ‚Ğ° Ğ¸Ğ· Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ğ°)
        $isbn = str_replace(['-', ' '], '', $model->isbn);
        if (strlen($isbn) !== 13 || !ctype_digit($isbn)) {
            $model->addError('isbn', 'ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ ISBN');
        }
        
        if (!$model->hasErrors() && $model->save()) {
            // Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ²
            Yii::$app->db->createCommand()
                ->delete('book_authors', ['book_id' => $model->id])
                ->execute();
            foreach ($model->authorIds as $authorId) {
                Yii::$app->db->createCommand()->insert('book_authors', [
                    'book_id' => $model->id,
                    'author_id' => $authorId,
                ])->execute();
            }
            
            // Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ°Ğ¼
            $phones = Subscription::find()
                ->select('phone')
                ->where(['author_id' => $model->authorIds])
                ->column();
            foreach ($phones as $phone) {
                $sms = new SmsClient(Yii::$app->params['smsApiKey']);
                $sms->send($phone, "ĞĞ¾Ğ²Ğ°Ñ ĞºĞ½Ğ¸Ğ³Ğ°: {$model->title}");
            }
            
            Yii::$app->session->setFlash('success', 'ĞšĞ½Ğ¸Ğ³Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°');
            return $this->redirect(['view', 'id' => $model->id]);
        }
    }
    
    return $this->render('create', [
        'model' => $model,
        'authors' => ArrayHelper::map(Author::find()->all(), 'id', 'fio'),
    ]);
}
```

#### âœ… ĞŸĞ»ÑÑÑ‹:
- Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ (30 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
- Ğ’ÑÑ‘ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ â€” Ğ»ĞµĞ³ĞºĞ¾ Ğ½Ğ°Ğ¹Ñ‚Ğ¸
- ĞĞµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ´ÑƒĞ¼Ğ°Ñ‚ÑŒ Ğ¾Ğ± Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ

#### âŒ ĞœĞ¸Ğ½ÑƒÑÑ‹:
- **60+ ÑÑ‚Ñ€Ğ¾Ğº** Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğµ
- `actionUpdate` â€” ĞºĞ¾Ğ¿Ğ¸Ğ¿Ğ°ÑÑ‚Ğ° Ñ 80% ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸ĞµĞ¼
- SMS Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ (100 Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ² = 30 ÑĞµĞº)
- Ğ¢ĞµÑÑ‚Ñ‹? ĞÑƒĞ¶ĞµĞ½ Yii + Ğ±Ğ°Ğ·Ğ° + Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° + SMS API
- ĞŸĞ¾Ğ¼ĞµĞ½ÑĞ» Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ISBN â€” Ñ‚Ñ€Ğ¾Ğ³Ğ°ĞµÑˆÑŒ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€
- ĞŸĞ¾Ğ¼ĞµĞ½ÑĞ» Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ SMS â€” Ñ‚Ñ€Ğ¾Ğ³Ğ°ĞµÑˆÑŒ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€

---

### Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2: ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ + Ğ¡ĞµÑ€Ğ²Ğ¸Ñ

```php
// controllers/BookController.php
public function actionCreate()
{
    $model = new Book();
    
    if ($model->load(Yii::$app->request->post()) && $model->validate()) {
        $service = new BookService();
        $bookId = $service->create($model);
        
        if ($bookId) {
            Yii::$app->session->setFlash('success', 'ĞšĞ½Ğ¸Ğ³Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°');
            return $this->redirect(['view', 'id' => $bookId]);
        }
    }
    
    return $this->render('create', [
        'model' => $model,
        'authors' => ArrayHelper::map(Author::find()->all(), 'id', 'fio'),
    ]);
}
```

```php
// services/BookService.php
class BookService
{
    public function create(Book $model): ?int
    {
        $transaction = Yii::$app->db->beginTransaction();
        
        try {
            // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ°
            $file = UploadedFile::getInstance($model, 'coverFile');
            if ($file) {
                $path = 'uploads/' . uniqid() . '.' . $file->extension;
                $file->saveAs(Yii::getAlias('@webroot/' . $path));
                $model->cover_url = '/' . $path;
            }
            
            if (!$model->save()) {
                throw new \Exception('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ');
            }
            
            $this->syncAuthors($model->id, $model->authorIds);
            $transaction->commit();
            
            $this->notifySubscribers($model);
            
            return $model->id;
        } catch (\Exception $e) {
            $transaction->rollBack();
            Yii::error($e->getMessage());
            return null;
        }
    }
    
    private function syncAuthors(int $bookId, array $authorIds): void
    {
        // ... ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
    }
    
    private function notifySubscribers(Book $model): void
    {
        // ... SMS
    }
}
```

#### âœ… ĞŸĞ»ÑÑÑ‹:
- ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ Ñ‚Ğ¾Ğ½ĞºĞ¸Ğ¹ (15 ÑÑ‚Ñ€Ğ¾Ğº)
- Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ (Create/Update Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸Ñ)
- Ğ›ĞµĞ³Ñ‡Ğµ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ

#### âŒ ĞœĞ¸Ğ½ÑƒÑÑ‹:
- Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ²ÑÑ‘ ĞµÑ‰Ñ‘ **Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ `Book` (ActiveRecord)**
- Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ `UploadedFile`, `Yii::$app`
- **Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:** Ğ²ÑÑ‘ ĞµÑ‰Ñ‘ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ²ÑÑ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°
- SMS Ğ²ÑÑ‘ ĞµÑ‰Ñ‘ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
- ĞĞ´Ğ¸Ğ½ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ½Ğ° 200+ ÑÑ‚Ñ€Ğ¾Ğº (BookService Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ’Ğ¡Ğ)
- Ğ¡ĞµÑ€Ğ²Ğ¸Ñ â€” ÑÑ‚Ğ¾ "Ñ‚Ğ¾Ğ»ÑÑ‚Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€, Ğ²Ñ‹Ğ½ĞµÑĞµĞ½Ğ½Ñ‹Ğ¹ Ğ² ĞºĞ»Ğ°ÑÑ"

---

### Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 3: Clean Architecture (ÑÑ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚)

```php
// presentation/controllers/BookController.php
public function actionCreate(): string|Response|array
{
    $form = new BookForm();

    if ($this->request->isPost && $form->loadFromRequest($this->request)) {
        if ($this->request->isAjax) {
            $this->response->format = Response::FORMAT_JSON;
            return ActiveForm::validate($form);
        }

        if ($form->validate()) {
            $bookId = $this->commandHandler->createBook($form);
            if ($bookId !== null) {
                return $this->redirect(['view', 'id' => $bookId]);
            }
        }
    }

    return $this->render('create', [
        'model' => $form,
        'authors' => $this->viewDataFactory->getAuthorsList(),
    ]);
}
```

```php
// presentation/books/handlers/BookCommandHandler.php
public function createBook(BookForm $form): ?int
{
    $coverPath = $this->uploadCover($form);
    
    try {
        $command = $this->mapper->toCreateCommand($form, $coverPath);
        $bookId = $this->createBookUseCase->execute($command);
        $this->notifier->success(Yii::t('app', 'Book has been created'));
        return $bookId;
    } catch (DomainException $e) {
        $this->cleanupFile($coverPath);
        $this->addFormError($form, $e); // ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğµ Ñ„Ğ¾Ñ€Ğ¼Ñ‹
        return null;
    }
}
```

```php
// application/books/usecases/CreateBookUseCase.php
public function execute(CreateBookCommand $command): int
{
    $this->transaction->begin();
    
    try {
        $book = Book::create(
            title: $command->title,
            year: new BookYear($command->year),
            isbn: new Isbn($command->isbn),
            description: $command->description,
            coverUrl: $command->cover
        );
        
        $book->replaceAuthors($command->authorIds);
        $this->bookRepository->save($book);
        $bookId = $book->getId();
        
        // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ°
        $this->transaction->afterCommit(fn() => 
            $this->eventPublisher->publishEvent(new BookCreatedEvent($bookId))
        );
        
        $this->transaction->commit();
        return $bookId;
    } catch (\Throwable $e) {
        $this->transaction->rollBack();
        throw $e;
    }
}
```

```php
// domain/values/Isbn.php
final readonly class Isbn
{
    public string $value;
    
    public function __construct(string $isbn)
    {
        $normalized = $this->normalize($isbn);
        if (!$this->isValidChecksum($normalized)) {
            throw new DomainException("ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ ISBN: {$isbn}");
        }
        $this->value = $normalized;
    }
}
```

#### âœ… ĞŸĞ»ÑÑÑ‹:
- **UseCase Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ Yii** â€” Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¹ PHP
- **Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾** â€” mock-Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹
- **SMS Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸** â€” ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾
- **Value Object** â€” Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ ISBN
- **ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ = Ğ¾Ğ´Ğ½Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**
- **Ğ›ĞµĞ³ĞºĞ¾ Ğ¼ĞµĞ½ÑÑ‚ÑŒ:** Ğ½Ğ¾Ğ²Ñ‹Ğ¹ SMS-Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ = Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ°Ğ´Ğ°Ğ¿Ñ‚ĞµÑ€, UseCase Ğ½Ğµ Ñ‚Ñ€Ğ¾Ğ³Ğ°ĞµĞ¼

#### âŒ ĞœĞ¸Ğ½ÑƒÑÑ‹:
- **ĞœĞ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²** (Form + Mapper + Command + UseCase + Repository + Event)
- **Ğ”Ğ¾Ğ»ÑŒÑˆĞµ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ** Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾
- **Overkill** Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… CRUD
- **ĞÑƒĞ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹**

---

## ğŸ“ˆ Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°

Ğ”Ğ»Ñ Ğ¾Ñ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ğ°: Â«Ñ‚Ğ¾Ğ»ÑÑ‚Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Â» = Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Yii2 CRUD Ğ½Ğ° ActiveRecord, Â«+Ğ¡ĞµÑ€Ğ²Ğ¸ÑÂ» = Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸ÑĞ½Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ¹ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… AR.

| ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ | Ğ¢Ğ¾Ğ»ÑÑ‚Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ | +Ğ¡ĞµÑ€Ğ²Ğ¸Ñ | Clean Architecture |
|----------|-------------------|---------|-------------------|
| **Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸** | âš¡ 30 Ğ¼Ğ¸Ğ½ | âš¡ 1 Ñ‡Ğ°Ñ | ğŸ¢ 3-4 Ñ‡Ğ°ÑĞ° |
| **Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ½Ğ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ** | 1 | 2 | 6-8 |
| **Ğ¡Ñ‚Ñ€Ğ¾Ğº ĞºĞ¾Ğ´Ğ°** | 60 Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ | 15 + 80 | 15 + 20 + 25 + ... |
| **Unit-Ñ‚ĞµÑÑ‚Ñ‹** | âŒ ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ | âš ï¸ Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ | âœ… Ğ›ĞµĞ³ĞºĞ¾ |
| **ĞŸĞ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ°Ğ¼Ğ¸** | 0-10% | 10-30% | 80-95% |
| **SMS Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚** | âœ… Ğ”Ğ° | âœ… Ğ”Ğ° | âŒ ĞĞµÑ‚ (Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ) |
| **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ‚ Yii** | ğŸ”´ Ğ’ĞµĞ·Ğ´Ğµ | ğŸŸ¡ Ğ’ ÑĞµÑ€Ğ²Ğ¸ÑĞµ | ğŸŸ¢ Infrastructure + Presentation |
| **Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° SMS** | ĞŸÑ€Ğ°Ğ²Ğ¸Ğ¼ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ | ĞŸÑ€Ğ°Ğ²Ğ¸Ğ¼ ÑĞµÑ€Ğ²Ğ¸Ñ | ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ°Ğ´Ğ°Ğ¿Ñ‚ĞµÑ€ |
| **ĞšĞ¾Ğ¿Ğ¸Ğ¿Ğ°ÑÑ‚Ğ° Create/Update** | 80% | 50% | 10% |
| **ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ¾Ğ¼ĞµĞ½Ğ°** | Ğ’ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ğµ | Ğ’ ÑĞµÑ€Ğ²Ğ¸ÑĞµ | Entity/Policy |
| **ĞŸĞ¾Ğ¸ÑĞº/Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ** | AR Ğ² ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ğµ | AR Ğ² ÑĞµÑ€Ğ²Ğ¸ÑĞµ | Specifications + QueryService |
| **Onboarding Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ´ĞµĞ²Ğ°** | âš¡ 1 Ğ´ĞµĞ½ÑŒ | 2-3 Ğ´Ğ½Ñ | 1 Ğ½ĞµĞ´ĞµĞ»Ñ |
| **ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· 2 Ğ³Ğ¾Ğ´Ğ°** | ğŸ˜± ĞĞ´ | ğŸ˜ ĞĞ¾Ñ€Ğ¼ | ğŸ˜Š Ğ›ĞµĞ³ĞºĞ¾ |

---

## ğŸ§© ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½: Ğ±Ñ‹Ğ»Ğ¾ â†’ ÑÑ‚Ğ°Ğ»Ğ¾

### 1. Form (Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ)

**Ğ‘Ñ‹Ğ»Ğ¾ (Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Book):**
```php
class Book extends ActiveRecord
{
    public $coverFile;  // Ğ”Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
    public $authorIds;  // Ğ”Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ñ‹
    
    public function rules()
    {
        return [
            // ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ»Ñ Ğ‘Ğ”
            ['title', 'string', 'max' => 255],
            // + Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ñ‹
            ['coverFile', 'file', 'extensions' => 'png, jpg'],
            // + ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸ create/update
        ];
    }
}
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ ÑĞ¼ĞµÑˆĞ¸Ğ²Ğ°ĞµÑ‚ "Ñ‡Ñ‚Ğ¾ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ" Ğ¸ "Ñ‡Ñ‚Ğ¾ Ğ²Ğ²Ñ‘Ğ» ÑĞ·ĞµÑ€"

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾ (BookForm):**
```php
// Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ğ²Ğ¾Ğ´Ğ°
class BookForm extends Model
{
    public ?string $title = null;
    public ?UploadedFile $coverFile = null;  // Ğ¤Ğ°Ğ¹Ğ» Ğ¾Ñ‚ ÑĞ·ĞµÑ€Ğ°
    public array $authorIds = [];
}

// ActiveRecord Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¹
class Book extends ActiveRecord
{
    // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ»Ñ Ğ‘Ğ”: title, cover_url, year, isbn
}
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ `UploadedFile`. Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ Ğ‘Ğ”.

---

### 2. Command (Ñ‡Ñ‘Ñ‚ĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)

**Ğ‘Ñ‹Ğ»Ğ¾:**
```php
$service->create($model);  // Book? BookForm? Array? Ğ¥Ğ·
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ñ‡Ñ‚Ğ¾ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `$model`? ĞšĞ°ĞºĞ¸Ğµ Ğ¿Ğ¾Ğ»Ñ ĞµÑÑ‚ÑŒ?

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
$command = new CreateBookCommand(
    title: 'ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ',
    year: 2024,
    isbn: '9783161484100',
    authorIds: [1, 2],
    cover: '/uploads/cover.jpg'  // Ğ£Ğ¶Ğµ URL, Ğ½Ğµ Ñ„Ğ°Ğ¹Ğ»!
);
$useCase->execute($command);
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** IDE Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚. Ğ¢Ğ¸Ğ¿Ñ‹ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ğµ. ĞĞµĞ»ÑŒĞ·Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ Ñ„Ğ¸Ğ³Ğ½Ñ.

---

### 3. Mapper (Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)

**Ğ‘Ñ‹Ğ»Ğ¾ (Ğ² ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ğµ):**
```php
$command = new CreateBookCommand(
    $form->title,
    $form->year,
    $form->isbn,
    $form->authorIds,
    $coverUrl  // Ğ¾Ñ‚ĞºÑƒĞ´Ğ°-Ñ‚Ğ¾ Ğ²Ğ·ÑĞ»ÑÑ
);
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞºĞ¾Ğ¿Ğ¸Ğ¿Ğ°ÑÑ‚Ğ° Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ğµ

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// presentation/mappers/BookFormMapper.php
class BookFormMapper
{
    public function toCreateCommand(BookForm $form, ?string $coverUrl): CreateBookCommand
    {
        return new CreateBookCommand(
            title: $form->title,
            year: $form->year,
            isbn: $form->isbn,
            authorIds: $form->authorIds,
            cover: $coverUrl
        );
    }
}
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ. DRY.

---

### 4. UseCase (Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°)

**Ğ‘Ñ‹Ğ»Ğ¾ (Ğ² ÑĞµÑ€Ğ²Ğ¸ÑĞµ):**
```php
class BookService
{
    public function create(Book $model) { /* 100 ÑÑ‚Ñ€Ğ¾Ğº */ }
    public function update(Book $model) { /* 100 ÑÑ‚Ñ€Ğ¾Ğº */ }
    public function delete(int $id) { /* 30 ÑÑ‚Ñ€Ğ¾Ğº */ }
    public function search(string $q) { /* 50 ÑÑ‚Ñ€Ğ¾Ğº */ }
    // ... 500 ÑÑ‚Ñ€Ğ¾Ğº
}
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ¾Ğ´Ğ¸Ğ½ Ñ„Ğ°Ğ¹Ğ» Ğ½Ğ° 500 ÑÑ‚Ñ€Ğ¾Ğº. God Object.

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// ĞĞ´Ğ¸Ğ½ Ñ„Ğ°Ğ¹Ğ» = Ğ¾Ğ´Ğ½Ğ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ
app/application/books/usecases/
â”œâ”€â”€ CreateBookUseCase.php   // 30 ÑÑ‚Ñ€Ğ¾Ğº
â”œâ”€â”€ UpdateBookUseCase.php   // 25 ÑÑ‚Ñ€Ğ¾Ğº
â”œâ”€â”€ DeleteBookUseCase.php   // 15 ÑÑ‚Ñ€Ğ¾Ğº
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğµ ĞºĞ»Ğ°ÑÑÑ‹. Ğ›ĞµĞ³ĞºĞ¾ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ.

---

### 5. Repository (Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ñ Ğ‘Ğ”)

**Ğ‘Ñ‹Ğ»Ğ¾:**
```php
// Ğ’ ÑĞµÑ€Ğ²Ğ¸ÑĞµ
$book = Book::findOne($id);
$book->title = $newTitle;
$book->save();
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ÑĞµÑ€Ğ²Ğ¸Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ ActiveRecord

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ (application/ports/)
interface BookRepositoryInterface
{
    public function save(Book $book): void;
    public function get(int $id): Book;
    public function delete(Book $book): void;
    public function existsByIsbn(string $isbn, ?int $excludeId = null): bool;
}

// ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ read-Ğ¿Ğ¾Ñ€Ñ‚ (ISP)
interface BookQueryServiceInterface
{
    public function findByIdWithAuthors(int $id): ?BookReadDto;
    public function search(string $term, int $page, int $pageSize): PagedResultInterface;
}

// Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (infrastructure/repositories/)
class BookRepository implements BookRepositoryInterface
{
    public function __construct(private Connection $db) {} // Ğ˜Ğ½ÑŠĞµĞºÑ†Ğ¸Ñ!

    public function save(BookEntity $book): void
    {
        // ... mapping
        $ar->save();
        
        // ... saving relations using $this->db
    }
}
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** UseCase Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°. Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ **Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Yii::$app**.
Readâ€‘Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹Ğ½ĞµÑĞµĞ½Ñ‹ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ `BookQueryServiceInterface` (ISP), Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ queryâ€‘Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ½Ğµ Ñ‚ÑĞ½ÑƒĞ»Ğ° writeâ€‘ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚.

---

### 6. Value Object (Ğ´Ğ¾Ğ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°)

**Ğ‘Ñ‹Ğ»Ğ¾:**
```php
// Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ·Ğ¼Ğ°Ğ·Ğ°Ğ½Ğ°
// Ğ’ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ğµ:
if (!preg_match('/^\d{13}$/', $isbn)) { ... }
// Ğ’ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸:
['isbn', 'match', 'pattern' => '/^\d{13}$/']
// Ğ˜ Ğ²ÑÑ‘ Ñ€Ğ°Ğ²Ğ½Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾:
$book->isbn = 'Ñ„Ğ¸Ğ³Ğ½Ñ';
$book->save();  // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ!
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ ISBN Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ğ¿Ğ°ÑÑ‚ÑŒ Ğ² Ğ‘Ğ”

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// domain/values/Isbn.php
$isbn = new Isbn('Ñ„Ğ¸Ğ³Ğ½Ñ');  // DomainException!
$isbn = new Isbn('9783161484100');  // OK

// Ğ’ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸
public function create(..., Isbn $isbn, ...)
{
    $book->isbn = $isbn->value;  // Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹
}
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ ISBN. Ğ¢Ğ¾Ñ‡ĞºĞ°.

---

### 7. Domain Event (Ñ€Ğ°Ğ·Ğ²ÑĞ·ĞºĞ°)

**Ğ‘Ñ‹Ğ»Ğ¾:**
```php
// Ğ’ ÑĞµÑ€Ğ²Ğ¸ÑĞµ Ğ¿Ğ¾ÑĞ»Ğµ save()
$this->sendSms(...);  // Ğ ĞµÑĞ»Ğ¸ SMS ÑƒĞ¿Ğ°Ğ´Ñ‘Ñ‚?
$this->sendEmail(...);  // Ğ ĞµÑĞ»Ğ¸ email ÑƒĞ¿Ğ°Ğ´Ñ‘Ñ‚?
// ĞšĞ½Ğ¸Ğ³Ğ° Ğ½Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ? Ğ˜Ğ»Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ½Ğ¾ Ğ±ĞµĞ· ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹?
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ½Ğ¸Ğ³Ğ¸ Ğ·Ğ°Ğ²ÑĞ·Ğ°Ğ½Ğ¾ Ğ½Ğ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ SMS

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// UseCase
// ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· afterCommit (Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸)
$this->transaction->afterCommit(fn() => 
    $this->eventPublisher->publishEvent(new BookCreatedEvent($bookId))
);
```
Ğ¡Ğ»ÑƒÑˆĞ°Ñ‚ĞµĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾ Ñ‡ĞµÑ€ĞµĞ· `EventListenerInterface`, Ğ° Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ ÑƒÑ…Ğ¾Ğ´ÑÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ, Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒÑÑ‰Ğ¸Ğµ `QueueableEvent`. ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Event â†’ Job Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ `EventToJobMapper` Ğ² Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ´Ğ¾Ğ¼ĞµĞ½ Ğ½Ğµ Ğ·Ğ½Ğ°Ğ» Ğ¾ job-ĞºĞ»Ğ°ÑÑĞ°Ñ….
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** ÑƒĞ¿Ğ°Ğ» SMS? ĞšĞ½Ğ¸Ğ³Ğ° Ğ²ÑÑ‘ Ñ€Ğ°Ğ²Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°. SMS Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑÑ Ğ¸Ğ· Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸.

---

### 8. Queue (Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ)

**Ğ‘Ñ‹Ğ»Ğ¾:**
```php
foreach ($subscribers as $sub) {
    $sms->send($sub->phone, ...);  // 100 SMS = 30 ÑĞµĞº
}
// Ğ®Ğ·ĞµÑ€ Ğ¶Ğ´Ñ‘Ñ‚...
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¿Ğ¾ĞºĞ° ÑˆĞ»ÑÑ‚ÑÑ SMS

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// Event â†’ Ğ¾Ğ´Ğ½Ğ° Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ (Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ´ĞµĞ»Ğ°ĞµÑ‚ EventToJobMapper)
Yii::$app->queue->push(new NotifySubscribersJob($bookId));
// Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾

// Ğ’Ğ¾Ñ€ĞºĞµÑ€ Ğ² Ñ„Ğ¾Ğ½Ğµ:
// NotifySubscribersJob â†’ 100x NotifySingleSubscriberJob (Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾)
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** ÑĞ·ĞµÑ€ Ğ½Ğµ Ğ¶Ğ´Ñ‘Ñ‚. SMS Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ñ„Ğ¾Ğ½Ğ¾Ğ¼. Ğ ĞµÑ‚Ñ€Ğ°Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ.

---

### 9. Entity (Rich Domain Model)

**Ğ‘Ñ‹Ğ»Ğ¾:**
```php
// ActiveRecord = Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ + Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° + persistence
class Book extends ActiveRecord
{
    public function publish(): void
    {
        $this->status = 'published';
        $this->save();  // Persistence Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
    }
}
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** AR ÑĞ¼ĞµÑˆĞ¸Ğ²Ğ°ĞµÑ‚ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ñ Ğ‘Ğ”. ĞĞµĞ»ÑŒĞ·Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±ĞµĞ· Ğ±Ğ°Ğ·Ñ‹.

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// domain/entities/Book.php â€” Ñ‡Ğ¸ÑÑ‚Ñ‹Ğ¹ PHP, Ğ±ĞµĞ· Yii
final class Book
{
    // ...
    public function publish(): void
    {
        if ($this->authorIds === []) {
            throw new DomainException('book.error.publish_without_authors');
        }
        $this->published = true;
    }
    
    // Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞ°Ğ¼Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ²Ğ¾Ğ¸Ğ¼Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°Ğ¼Ğ¸
    public function addAuthor(int $authorId): void { ... }
}
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** Entity Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Ğ‘Ğ”. Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ±ĞµĞ· Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹. Value Objects Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒÑÑ‚ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ.

Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ² Ğ´Ğ¾Ğ¼ĞµĞ½Ğµ:
- **Domain Services** (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, `BookPublicationPolicy`) Ğ´Ğ»Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ», ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ°Ñ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸.
- **Specifications** Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ĞºÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸ĞµĞ² Ğ¿Ğ¾Ğ¸ÑĞºĞ° (`BookSearchSpecificationFactory`, `YearSpecification`).

---

### 10. Optimistic Locking (ĞšĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ)

**Ğ‘Ñ‹Ğ»Ğ¾:**
```php
// ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ» ĞºĞ½Ğ¸Ğ³Ñƒ. ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ‘ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ» Ñ‚Ñƒ Ğ¶Ğµ ĞºĞ½Ğ¸Ğ³Ñƒ.
// Ğ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ». Ğ‘ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ» (Ğ·Ğ°Ñ‚ĞµÑ€ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ).
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸĞ¾Ñ‚ĞµÑ€Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Lost Update).

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// Repository
try {
    $ar->version = $book->getVersion();
    $ar->save(); // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ version = DB.version
} catch (StaleObjectException $e) {
    throw new StaleDataException(); // ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ Ğ¿Ğ¾ĞºĞ°Ğ¶ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ
}
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ‘ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ "Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ»Ğ¸, Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ". Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸.

---

### 11. Handlers (Presentation Layer)

**Ğ‘Ñ‹Ğ»Ğ¾:**
```php
// ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ²ÑÑ‘
public function actionCreate()
{
    $form = new BookForm();
    if ($form->load($request) && $form->validate()) {
        $file = UploadedFile::getInstance($form, 'cover');
        $path = $this->uploadFile($file);
        $command = new CreateBookCommand(...);
        $this->useCase->execute($command);
    }
}
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ…, Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğµ, Use Case. Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ.

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// presentation/books/handlers/BookCommandHandler.php
final readonly class BookCommandHandler
{
    public function createBook(BookForm $form): ?int
    {
        $coverPath = $this->uploadCover($form);
        
        try {
            $command = $this->mapper->toCreateCommand($form, $coverPath);
            return $this->createBookUseCase->execute($command);
        } catch (DomainException $e) {
            $this->addFormError($form, $e); // ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğµ
            return null;
        }
    }
}
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** Handler Ğ¸Ğ½ĞºĞ°Ğ¿ÑÑƒĞ»Ğ¸Ñ€ÑƒĞµÑ‚ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ. ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ HTTP.

---

### 12. Validation Strategy (Pragmatic Approach)

**Ğ‘Ñ‹Ğ»Ğ¾ (Standard Yii2):**
```php
// Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ² ActiveRecord
class Book extends ActiveRecord
{
    public function rules()
    {
        return [
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ = Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ² Ğ‘Ğ” Ğ¿Ñ€Ğ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
            [['isbn'], 'unique'],
        ];
    }
}
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
1. **Ğ¡Ğ¼ĞµÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:** Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ/Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Ğ‘Ğ°Ğ·Ğµ Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ….
2. **Race Condition:** Ğ¼ĞµĞ¶Ğ´Ñƒ `SELECT count(*)` (Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ) Ğ¸ `INSERT` Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‚ÑŒÑÑ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ.
3. **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ:** Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ±ĞµĞ· Ñ€Ğ°Ğ±Ğ¾Ñ‡ĞµĞ¹ Ğ‘Ğ”.

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾ (Clean-ish):**
```php
// Presentation (Form) â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
class BookForm extends Model {
    public function rules() {
        return [['isbn', 'string', 'length' => 13]]; // Ğ§Ğ¸ÑÑ‚Ñ‹Ğ¹ PHP
    }
}

// Infrastructure (Repository) â€” Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ
public function save(Book $book): void {
    try {
        $ar->save(); // Unique Index Ğ² Ğ‘Ğ” Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ
    } catch (IntegrityException $e) {
        throw new AlreadyExistsException("ISBN exists");
    }
}

// Controller â€” Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
try {
    $this->useCase->create(...);
} catch (AlreadyExistsException $e) {
    $form->addError('isbn', $e->getMessage());
}
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** Presentation ÑĞ»Ğ¾Ğ¹ Ñ‡Ğ¸ÑÑ‚ Ğ¸ Ñ‚ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼. Ğ¦ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ‘Ğ”. ĞĞµÑ‚ Race Condition.

---

### 13. Specification (Ğ¿Ğ¾Ğ¸ÑĞº Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ)

**Ğ‘Ñ‹Ğ»Ğ¾:**
```php
// Ğ’ UseCase Ğ¸Ğ»Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞµ
return Book::find()
    ->where(['year' => $year])
    ->andWhere(['like', 'title', $term])
    ->all();
```
âŒ **ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ±Ğ¸Ğ·Ğ½ĞµÑ-ÑĞ»Ğ¾Ğ¹ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ AR Ğ¸ SQL-Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸.

**Ğ¡Ñ‚Ğ°Ğ»Ğ¾:**
```php
// Domain: Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºĞ° ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¹
$spec = $this->specFactory->create($term);

// QueryService: Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
$result = $this->bookQueryService->searchBySpecification($spec);
```
âœ… **Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** ĞºÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ² Ğ´Ğ¾Ğ¼ĞµĞ½Ğµ, Ğ° SQL Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ Ğ² Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ.

---


## ğŸ¯ ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ°ĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´

| Ğ¡Ğ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ |
|----------|--------------|
| ĞŸÑ€Ğ¾Ñ‚Ğ¾Ñ‚Ğ¸Ğ¿ Ğ·Ğ° 2 Ñ‡Ğ°ÑĞ° | Ğ¢Ğ¾Ğ»ÑÑ‚Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ |
| Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ (1-2 Ğ´ĞµĞ²Ğ°) | ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€ + Ğ¡ĞµÑ€Ğ²Ğ¸Ñ |
| Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° | Clean Architecture |
| ĞÑƒĞ¶Ğ½Ñ‹ Ñ‚ĞµÑÑ‚Ñ‹ | Clean Architecture |
| Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ (SMS, Payment, API) | Clean Architecture |
| 3+ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ° | Clean Architecture |
| ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ½Ğ° 2+ Ğ³Ğ¾Ğ´Ğ° | Clean Architecture |

---

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```text
yii2-book-catalog/
â”œâ”€â”€ assets/                  # Frontend assets
â”œâ”€â”€ bin/                     # ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹
â”œâ”€â”€ application/             # Application Layer (Use Cases, Queries, Ports)
â”‚   â”œâ”€â”€ books/               # ĞœĞ¾Ğ´ÑƒĞ»ÑŒ "ĞšĞ½Ğ¸Ğ³Ğ¸"
â”‚   â”‚   â”œâ”€â”€ commands/        # DTO ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ (CreateBookCommand)
â”‚   â”‚   â”œâ”€â”€ queries/         # DTO Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (BookReadDto)
â”‚   â”‚   â””â”€â”€ usecases/        # Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸ (CreateBookUseCase)
â”‚   â”œâ”€â”€ authors/             # ĞœĞ¾Ğ´ÑƒĞ»ÑŒ "ĞĞ²Ñ‚Ğ¾Ñ€Ñ‹" (Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°)
â”‚   â”œâ”€â”€ subscriptions/       # ĞœĞ¾Ğ´ÑƒĞ»ÑŒ "ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸"
â”‚   â”œâ”€â”€ reports/             # ĞœĞ¾Ğ´ÑƒĞ»ÑŒ "ĞÑ‚Ñ‡ĞµÑ‚Ñ‹"
â”‚   â”œâ”€â”€ common/              # ĞĞ±Ñ‰Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ (IdempotencyService, DTO)
â”‚   â””â”€â”€ ports/               # Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ (EventPublisher, EventListener, Mutex, Repository, QueryService)
â”œâ”€â”€ domain/                  # Domain Layer (Ğ§Ğ¸ÑÑ‚Ñ‹Ğ¹ PHP)
â”‚   â”œâ”€â”€ entities/            # Rich Entities (Book, Author)
â”‚   â”œâ”€â”€ events/              # Domain Events & QueueableEvent
â”‚   â”œâ”€â”€ exceptions/          # Domain Exceptions (StaleDataException)
â”‚   â”œâ”€â”€ services/            # Domain Services (BookPublicationPolicy)
â”‚   â”œâ”€â”€ specifications/      # Specifications (Ğ¿Ğ¾Ğ¸ÑĞº/Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ)
â”‚   â””â”€â”€ values/              # Value Objects (Isbn, BookYear)
â”œâ”€â”€ infrastructure/          # Infrastructure Layer (Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²)
â”‚   â”œâ”€â”€ adapters/            # ĞĞ´Ğ°Ğ¿Ñ‚ĞµÑ€Ñ‹ (YiiEventPublisher, EventToJobMapper, YiiMutex, YiiTransaction)
â”‚   â”œâ”€â”€ listeners/           # Event Listeners (ReportCacheInvalidation)
â”‚   â”œâ”€â”€ persistence/         # ActiveRecord Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ°)
â”‚   â”œâ”€â”€ queue/               # Queue Jobs
â”‚   â”œâ”€â”€ repositories/        # Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸ĞµĞ² (Strict DI)
â”‚   â”‚   â””â”€â”€ decorators/      # Tracing Decorators
â”‚   â””â”€â”€ services/            # Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (Logger, Storage)
â”œâ”€â”€ presentation/            # Presentation Layer (Yii2 & Web)
â”‚   â”œâ”€â”€ controllers/         # Ğ¢Ğ¾Ğ½ĞºĞ¸Ğµ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ñ‹
â”‚   â”œâ”€â”€ books/               # ĞœĞ¾Ğ´ÑƒĞ»ÑŒ "ĞšĞ½Ğ¸Ğ³Ğ¸" (Forms, Handlers, Mappers)
â”‚   â”œâ”€â”€ authors/             # ĞœĞ¾Ğ´ÑƒĞ»ÑŒ ĞĞ²Ñ‚Ğ¾Ñ€Ñ‹
â”‚   â”œâ”€â”€ common/              # ĞĞ±Ñ‰Ğ¸Ğµ Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚Ñ‹, Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (WebUseCaseRunner, IdempotencyFilter)
â”‚   â”œâ”€â”€ mail/                # Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Ğ¿Ğ¸ÑĞµĞ¼
â”‚   â””â”€â”€ views/               # Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ (Views)
â”œâ”€â”€ commands/                # Console ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ»ĞµÑ€Ñ‹ (CLI)
â”œâ”€â”€ config/                  # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”œâ”€â”€ db-data/                 # Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ‘Ğ” (volume)
â”œâ”€â”€ docker/                  # Docker-ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”œâ”€â”€ messages/                # ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ i18n
â”œâ”€â”€ migrations/              # ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ‘Ğ”
â”œâ”€â”€ runtime/                 # Runtime ĞºÑÑˆ/Ğ»Ğ¾Ğ³Ğ¸
â”œâ”€â”€ tests/                   # Ğ¢ĞµÑÑ‚Ñ‹
â”œâ”€â”€ tools/                   # Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ (PHPUnit, Rector)
â”œâ”€â”€ web/                     # Web root
â””â”€â”€ docs/                    # Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
```

**ĞĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹ Ğ¾Ñ‚ Yii:** `application/` + `domain/` â€” Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ Ğ² Symfony/Laravel Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹.

**Ğ—Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ Yii:** `infrastructure/` + `presentation/` â€” ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ñ‹ Ğ´Ğ»Ñ Yii2.
