---
name: discuss
description: Обсуждение задачи перед реализацией - несколько раундов уточняющих вопросов, декомпозиция, формирование спеки.
---

# Скилл: DISCUSS

## Обзор

Структурированное обсуждение задачи перед написанием кода. Цель — задать ВСЕ вопросы (включая очевидные), чтобы не тратить контекст и время на переделки. Результат — файл задачи с полной спецификацией.

## 1. Загрузка контекста

Молча прочитай `docs/ai/contract.md` — это база знаний проекта.

## 2. Получение задачи

Пользователь даёт задачу в любом формате: текст, ссылка, номер Jira, описание на салфетке. Прими как есть.

Если пользователь не указал ID задачи — спроси. ID нужен для создания файла.

## 3. Раунды уточнений

Проведи **минимум 2 раунда** вопросов. Каждый раунд — пачка вопросов (не по одному).

### Раунд 1: Базовое понимание (что и зачем)

Задай вопросы уровня "тупых" — те, которые стыдно спросить, но без ответа на которые можно уйти не туда:

- **ЧТО** конкретно должно произойти? (не "улучшить", а конкретный результат)
- **ЗАЧЕМ** это нужно? (бизнес-причина, контекст)
- **КТО** будет пользоваться? (роль пользователя, сценарий)
- **ГДЕ** это должно работать? (страница, модуль, API)
- Есть ли **примеры** или **референсы** желаемого результата?

### Раунд 2: Границы и ограничения (чего НЕ делаем)

После ответов на первый раунд, задай вопросы про границы:

- Что **НЕ** входит в задачу? (явные исключения)
- Есть ли **связанные** фичи, которые трогать нельзя?
- **Обратная совместимость** — что может сломаться?
- **Крайние случаи** — что если пустые данные, нет прав, etc?
- **Приоритет** — что важнее: скорость реализации или идеальность?

### Раунд 3+ (при необходимости): Техническая конкретика

Если после двух раундов остались неясности:

- Конкретные поля, типы данных, валидация
- Поведение UI (если есть)
- Миграции, связи в БД
- Влияние на существующие тесты

## 4. Декомпозиция (если нужна)

После сбора всех ответов честно оцени: **сможешь ли ты сделать это качественно за один `/go`?**

### Что считается сложным

Сложность — это НЕ количество файлов. Миграция, модель, простой CRUD — это рутина, не сложность.

Сложность — это когда:

- **Много взаимосвязанной логики**: результат одного куска зависит от другого, и если ошибёшься в первом — второй тоже будет неправильным, а найти причину будет тяжело.
- **Нетривиальные алгоритмы или бизнес-правила**: не просто "сохрани в базу", а сложные расчёты, цепочки условий, state-машины.
- **Много точек интеграции**: когда нужно чтобы фронт, бэк, база, внешний API — всё заработало вместе, и баг может быть на любом стыке.
- **Высокий риск неочевидных багов**: когда код может выглядеть рабочим, но ломаться на определённых данных или в определённой последовательности действий.

Если хотя бы один пункт — предложи разбить. 2-3 итерации — это нормально, не обязательно всё за один запрос.

### Проверка каждой итерации

После каждой итерации — проверка:

- **Можно пощупать в UI** (страница, форма, кнопка, выдача) — пользователь проверяет в браузере, AI проверяет через `curl`.
- **Нельзя пощупать** (миграция, внутренний сервис, рефакторинг) — достаточно `make dev` + `make test`.

Если задача простая и влезает в один запрос — не декомпозируй, не усложняй.

## 5. Создание файлов задачи

После подтверждения пользователя создай папку `docs/tasks/{ID}/` с отдельными файлами:

### `docs/tasks/{ID}/origin.md`

Исходное ТЗ и все ответы. Чтобы при потере контекста можно было прочитать и понять задачу целиком.

```markdown
# #{ID} — [краткое название задачи]

## Исходное ТЗ

[Оригинальное описание задачи как его дал пользователь]

## Уточнения

- **Вопрос**: [вопрос]
  **Ответ**: [ответ пользователя]
- **Вопрос**: [вопрос]
  **Ответ**: [ответ пользователя]

## Не делаем

- [явное исключение 1]
- [явное исключение 2]
```

### `docs/tasks/{ID}/decisions.md`

Ключевые решения с обоснованием. Чтобы в следующем `/go` не пришлось заново объяснять почему выбрали подход X.

```markdown
# Решения по #{ID}

- **[Решение 1]**: [почему выбрали именно так]
- **[Решение 2]**: [почему выбрали именно так]
```

### `docs/tasks/{ID}/iterations.md`

Итерации по которым двигаемся. Каждая итерация = один `/go` + коммит. Для простых задач — одна итерация.

```markdown
# Итерации по #{ID}

## Итерация 1: [название]
- Суть: [что делаем]
- Проверка: [как убедиться что работает — URL, curl-команда, или `make test`]
- Статус: ожидает

## Итерация 2: [название]
- Суть: [что делаем]
- Зависит от: итерация 1
- Проверка: [как убедиться]
- Статус: ожидает
```

### `docs/tasks/{ID}/checklist.md`

Конкретные действия для финальной проверки пользователем в браузере. Не абстрактные "проверить что работает", а конкретные: "открыть /admin/products, нажать Создать, заполнить форму, сохранить".

```markdown
# Чеклист по #{ID}

- [ ] [Что проверить в браузере — конкретный URL и действие]
- [ ] [Что проверить в браузере — конкретный URL и действие]
- [ ] [Что проверить в браузере — конкретный URL и действие]
- [ ] `make dev` — без ошибок
- [ ] `make test` — без ошибок
```

## 6. Подтверждение

Спроси пользователя: **"Всё верно? Корректировки?"**

- Если да → файл задачи создан, можно запускать `/go`.
- Если нет → ещё раунд уточнений, обновить файл.

## ПРАВИЛА

- Язык: СТРОГО РУССКИЙ.
- Задавай вопросы **пачкой**, не по одному — это экономит время.
- НЕ пропускай "очевидные" вопросы — лучше спросить и получить "ну да, очевидно" чем угадывать.
- НЕ пиши код — только обсуждение и создание файла задачи.
- НЕ предлагай решение, пока не собраны все ответы.
- Если пользователь отвечает расплывчато — переспроси конкретнее.
- Минимум 2 раунда. Даже если кажется что всё понятно — задай вопросы про границы.
