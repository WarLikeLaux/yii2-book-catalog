deptrac:
  paths:
    - application
    - domain
    - infrastructure
    - presentation
  
  exclude_files:
    - '#.*test.*#'
    - '#.*bootstrap.*#'

  layers:
    - name: DomainEntities
      collectors:
        - type: directory
          value: domain/entities/.*

    - name: DomainShared
      collectors:
        - type: directory
          value: domain/(values|events|exceptions)/.*
    
    - name: Application
      collectors:
        - type: directory
          value: application/.*
    
    - name: Infrastructure
      collectors:
        - type: directory
          value: infrastructure/.*
    
    - name: Presentation
      collectors:
        - type: directory
          value: presentation/.*
    
    - name: Framework
      collectors:
        - type: classLike
          value: ^yii\\.*

    - name: GlobalState
      collectors:
        - type: classLike
          value: ^Yii$

    - name: Vendor
      collectors:
        - type: classLike
          value: ^(Ramsey\\|Psr\\|Symfony\\|Doctrine\\).*  

  ruleset:
    DomainEntities:
      - DomainShared
      - Vendor

    DomainShared:
      - Vendor
    
    Application:
      - DomainEntities
      - DomainShared
      - Vendor
    
    Infrastructure:
      - DomainEntities
      - DomainShared
      - Application
      - Vendor
      - Framework

    Presentation:
      - DomainShared
      - Application
      - Vendor
      - Framework
      - GlobalState

  skip_violations:   
    # Адаптеры (разрешен доступ к Yii)
    app\infrastructure\adapters\YiiTranslatorAdapter:
      - Yii
    app\infrastructure\adapters\YiiAuthAdapter:
      - Yii
    
    # Инфраструктурные сервисы (разрешен доступ к Yii)
    app\infrastructure\services\YiiPsrLogger:
      - Yii
    app\infrastructure\services\notifications\FlashNotificationService:
      - Yii
    app\infrastructure\services\observability\TracerBootstrap:
      - Yii
